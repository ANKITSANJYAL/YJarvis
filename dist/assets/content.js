function m(){return document.querySelector("video.html5-main-video")}function y(n){try{n()}catch(e){console.warn("Jarvis: action failed",e)}}function w(n){const e=n.toLowerCase();if(e.includes("pause"))return{type:"PAUSE"};if(e.includes("play")||e.includes("resume"))return{type:"PLAY"};const t=e.match(/(forward|back|seek)\s*(\d+)(?:\s*seconds)?/);if(t){const s=Number(t[2]);return{type:"SEEK",seconds:e.includes("back")?-s:s}}const o=e.match(/volume\s*(\d{1,3})\s*%?/);return o?{type:"VOLUME_SET",value:Math.min(100,Math.max(0,Number(o[1])))}:null}const p={init(){},handleCommand(n){const e=w(n);if(!e)return!1;const t=m();return t?(y(()=>{switch(e.type){case"PLAY":t.play();break;case"PAUSE":t.pause();break;case"RESUME":t.play();break;case"SEEK":t.currentTime=Math.max(0,t.currentTime+e.seconds);break;case"VOLUME_SET":t.volume=e.value/100;break}}),!0):!1}},i={speak(n){if(!("speechSynthesis"in window))return;const e=new SpeechSynthesisUtterance(n);e.rate=1.05,e.pitch=1;const o=window.speechSynthesis.getVoices().find(s=>/en/.test(s.lang)&&/male|daniel|english/.test(s.name.toLowerCase()));o&&(e.voice=o),window.speechSynthesis.cancel(),window.speechSynthesis.speak(e)}};function S(n){const t=n.toLowerCase().match(/(search for|find|play)\s+(.+)/);return t?{kind:"search",query:t[2]??""}:{kind:"unknown"}}function k(){const n=window.webkitSpeechRecognition,e=window.SpeechRecognition||n;return e?new e:null}function v(n){const e=n.toLowerCase();return e.includes("jarvis")||e.includes("dummy")}const g={startWakeWord(n){const e=k();if(!e)return;e.continuous=!0,e.lang="en-US";let t=0,o="",s=null;e.onresult=r=>{const f=Math.max(0,r.results.length-1),c=r.results.item(f);if(!c||c.length===0)return;const a=c.item(0),u=a.transcript.trim(),h=a.confidence,d=Date.now();if(!(h<.7)){if(v(u)){t=d;return}d-t<3e3&&(o=u,s&&window.clearTimeout(s),s=window.setTimeout(()=>{n(o),s=null},500))}};try{e.start()}catch{}}};function l(){g.startWakeWord(n=>{if(p.handleCommand(n)){i.speak("At your service, sir.");return}const t=S(n);if(t.kind==="search"&&t.query){chrome.runtime.sendMessage({type:"YT_SEARCH_BEST",payload:{query:t.query}},o=>{if(o&&typeof o=="object"&&o!==null&&"videoId"in o){const s=o.videoId;i.speak("Playing your selection."),window.location.href=`https://www.youtube.com/watch?v=${encodeURIComponent(s)}`}});return}chrome.runtime.sendMessage({type:"AI_PROMPT",payload:{text:n}},o=>{typeof o=="string"&&o&&i.speak(o)})})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l();
